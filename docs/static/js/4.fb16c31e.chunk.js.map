{"version":3,"sources":["controller/trickle.ts","views/Trickle.tsx","site/pages/trickle/index.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/createClass.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/nonIterableSpread.js"],"names":["TrickleControl","data","colData","col","curIdx","this","num","slice","map","val","length","elements","heightList","ele","offsetTop","miniHeight","Math","min","indexOf","targetIdx","_findLowCol","addCurIdx","push","Trickle","childRender","refFlag","len","initColData","Array","fill","useState","setCol","waterfallControl","setData","dataManager","setCurIdx","useEffect","setFirstRowData","getColData","pushDataToLowCol","dataIdx","getCurIdx","imgReady","url","className","idx","key","style","width","sub","subIdx","src","txt","ref","name","desc","SubBody","props","_defineProperties","target","i","descriptor","enumerable","configurable","writable","Object","defineProperty","_createClass","Constructor","protoProps","staticProps","prototype","_toConsumableArray","arr","isArray","arr2","iter","Symbol","iterator","toString","call","from","TypeError"],"mappings":"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","file":"static/js/4.fb16c31e.chunk.js","sourcesContent":["\r\nclass TrickleControl {\r\n\r\n    data: Array<any>;\r\n    // len: number;\r\n    colData: Array<Array<any>>;\r\n    col: number;\r\n    curIdx: number;\r\n\r\n    constructor() {\r\n        this.data = [];\r\n        // this.len = 0;\r\n        this.colData = [];\r\n        this.col = 0;\r\n        this.curIdx = 0;\r\n    }\r\n\r\n    getColData() {\r\n        return this.colData;\r\n    }\r\n\r\n    getCurIdx(): number {\r\n        return this.curIdx;\r\n    }\r\n\r\n    setCol(col: number) {\r\n        this.col = col;\r\n    }\r\n\r\n    setData(data: Array<any>) {\r\n        this.data = data;\r\n        // this.len = data.length;\r\n    }\r\n    \r\n    addCurIdx(num = 1) {\r\n        this.curIdx += num; \r\n    }\r\n\r\n    setFirstRowData() {\r\n        this.colData = this.data.slice(0, this.col).map(val => [val]);\r\n        if (this.colData.length) {\r\n            this.curIdx = this.colData.length - 1;\r\n        }\r\n    }\r\n\r\n    _findLowCol(elements: Array<HTMLDivElement>) {\r\n        const heightList = elements.map(ele => ele.offsetTop);\r\n        const miniHeight = Math.min(...heightList);\r\n        const targetIdx = heightList.indexOf(miniHeight);\r\n        return targetIdx;\r\n    }\r\n\r\n    pushDataToLowCol(elements: Array<HTMLDivElement>) {\r\n        const targetIdx = this._findLowCol(elements);\r\n        this.addCurIdx();\r\n        this.colData[targetIdx].push(this.data[this.curIdx]);\r\n    }\r\n}\r\n\r\nexport default TrickleControl;","import React, { useState, useEffect } from 'react';\r\n\r\nimport { imgReady } from '../utils/base';\r\nimport TrickleControl from '../controller/trickle';\r\n\r\ninterface TrickleProps {\r\n    data: Array<any>,\r\n    col: number,\r\n    childRender: any\r\n}\r\n/* \r\n    瀑布流：图片需要从cdn下载，所以不能实时获取到图片宽高\r\n\r\n    已知获取图片宽高的方法\r\n    1. 限制图片宽高\r\n    2. 已知图片宽高\r\n    3. 等待图片加载获取宽高\r\n*/\r\nfunction Trickle({ data, col = 2, childRender }: TrickleProps) {\r\n\r\n    let refFlag: Array<HTMLDivElement | any> = [];\r\n    \r\n    const len = data.length;\r\n    const initColData = Array(col).fill('col').map(() => []) as Array<Array<any>>;\r\n    const [colData, setCol] = useState(initColData);\r\n\r\n    const waterfallControl = new TrickleControl();\r\n    waterfallControl.setData(data);\r\n    waterfallControl.setCol(col);\r\n    \r\n    const [dataManager] = useState(waterfallControl);\r\n    const [curIdx, setCurIdx] = useState(0);\r\n\r\n    useEffect(() => {\r\n        if (curIdx < len - 1) {\r\n            if (curIdx < col - 1) {\r\n                dataManager.setFirstRowData()\r\n                setCol(dataManager.getColData());\r\n            } else {\r\n                dataManager.pushDataToLowCol(refFlag);\r\n                setCol(dataManager.getColData());\r\n            }\r\n            const dataIdx = dataManager.getCurIdx();\r\n            imgReady(data[dataIdx].url, () => {\r\n                setCurIdx(dataIdx);\r\n            })\r\n        }\r\n    }, [curIdx])\r\n\r\n    return <div className=\"zui-waterfall zui-clearfix\">\r\n        {\r\n            colData.map((val, idx) => <div key={idx}\r\n                className=\"zui-waterfall-col\"\r\n                style={{\r\n                    width: 100/col + '%'\r\n                }}>\r\n                {\r\n                    val.map((sub, subIdx) => <div key={`${idx}-${subIdx}`}\r\n                        className=\"zui-waterfall-item\">\r\n                        <img\r\n                            className=\"zui-waterfall-img\"\r\n                            src={sub.url}\r\n                        />\r\n                        {/* 子模块可以自定义 */}\r\n                        { \r\n                            typeof childRender === 'function' ?\r\n                                childRender(sub) :\r\n                                <div>{sub.txt}</div>\r\n                        }\r\n                    </div>)\r\n                }\r\n                <div ref={ele => refFlag[idx] = ele}></div>\r\n            </div>)\r\n        }\r\n    </div>\r\n}\r\n\r\nexport default Trickle;\r\n","import React from 'react';\r\nimport Waterfall from '../../../views/Trickle'\r\n\r\nconst data = Array(21).fill('data').map((val, idx) => {\r\n    return {\r\n        url: `https://zhongmeizhi.github.io/static/test/${20-idx}.jpg`,\r\n        name: `瀑布流`,\r\n        desc: `${idx}`\r\n    }\r\n})\r\n\r\n\r\nfunction SubBody(props) {\r\n    return <div>\r\n        <p className=\"zui-waterfall-txt\">{props.name}</p>\r\n        <p className=\"zui-waterfall-txt\">{props.desc}</p>\r\n    </div>\r\n}\r\n\r\nexport default () => {\r\n    return <div>\r\n        <Waterfall data={data} col={3} childRender={SubBody}></Waterfall>\r\n    </div>\r\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}"],"sourceRoot":""}