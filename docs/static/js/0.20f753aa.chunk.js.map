{"version":3,"sources":["controller/waterfall.ts","views/Waterfall.tsx","site/pages/waterfall/index.js","site/pages/waterfall/data.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/createClass.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/_@babel_runtime@7.8.7@@babel/runtime/helpers/esm/nonIterableSpread.js"],"names":["WaterfallControl","data","colData","col","curIdx","colWidth","this","width","num","elements","heightList","map","ele","offsetTop","miniHeight","Math","min","indexOf","height","rate","targetIdx","_findLowCol","addCurIdx","slice","val","target","size","_formatSize","push","Waterfall","childRender","refFlag","len","length","initColData","Array","fill","useState","setCol","waterfallControl","setData","dataManager","setCurIdx","useEffect","offsetWidth","setColWidth","pushDataToLowCol","getColData","getCurIdx","className","idx","key","style","sub","subIdx","src","url","txt","ref","SubBody","props","formatData","sizeReg","match","Number","getSize","Object","assign","_defineProperties","i","descriptor","enumerable","configurable","writable","defineProperty","_createClass","Constructor","protoProps","staticProps","prototype","_toConsumableArray","arr","isArray","arr2","iter","Symbol","iterator","toString","call","from","TypeError"],"mappings":"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","file":"static/js/0.20f753aa.chunk.js","sourcesContent":["\r\nclass WaterfallControl {\r\n\r\n    data: Array<any>;\r\n    // len: number;\r\n    colData: Array<Array<any>>;\r\n    col: number;\r\n    curIdx: number;\r\n    colWidth: number;\r\n\r\n    constructor() {\r\n        this.data = [];\r\n        // this.len = 0;\r\n        this.colData = [];\r\n        this.col = 0;\r\n        this.curIdx = 0;\r\n        this.colWidth = 0;\r\n    }\r\n\r\n    getColData() {\r\n        return this.colData;\r\n    }\r\n\r\n    getCurIdx(): number {\r\n        return this.curIdx;\r\n    }\r\n\r\n    setColWidth(width: number) {\r\n        this.colWidth = width;\r\n    }\r\n\r\n    setCol(col: number) {\r\n        this.col = col;\r\n    }\r\n\r\n    setData(data: Array<any>) {\r\n        this.data = data;\r\n        // this.len = data.length;\r\n    }\r\n    \r\n    addCurIdx(num = 1) {\r\n        this.curIdx += num; \r\n    }\r\n\r\n    _findLowCol(elements: Array<HTMLDivElement>) {\r\n        const heightList = elements.map(ele => ele.offsetTop);\r\n        const miniHeight = Math.min(...heightList);\r\n        const targetIdx = heightList.indexOf(miniHeight);\r\n        return targetIdx;\r\n    }\r\n\r\n    _formatSize(width: number, height: number) {\r\n        const rate = this.colWidth / width;\r\n        return {\r\n            width: this.colWidth,\r\n            height: height * rate\r\n        }\r\n    }\r\n\r\n    pushDataToLowCol(elements: Array<HTMLDivElement>) {\r\n        const targetIdx = this._findLowCol(elements);\r\n        this.addCurIdx();\r\n        if (!this.colData[targetIdx]) {\r\n            this.colData = this.data.slice(0, this.col).map(val => []);\r\n        }\r\n        let target = this.data[this.curIdx];\r\n        const size = this._formatSize(target.width, target.height);\r\n        target.width = size.width;\r\n        target.height = size.height;\r\n        this.colData[targetIdx].push(target);\r\n    }\r\n}\r\n\r\nexport default WaterfallControl;","import React, { useState, useEffect } from 'react';\r\nimport WaterfallControl from '../controller/waterfall';\r\n\r\ninterface WaterfallProps {\r\n    data: Array<any>,\r\n    col: number,\r\n    childRender: any\r\n}\r\n/* \r\n    瀑布流：图片需要从cdn下载，所以不能实时获取到图片宽高\r\n\r\n    已知获取图片宽高的方法\r\n    1. 限制图片宽高\r\n    2. 已知图片宽高\r\n    3. 等待图片加载获取宽高\r\n\r\n    \r\n*/\r\nfunction Waterfall({ data, col = 2, childRender}: WaterfallProps) {\r\n\r\n    let refFlag: Array<HTMLDivElement | any> = [];\r\n    \r\n    const len = data.length;\r\n    const initColData = Array(col).fill('col').map(() => []) as Array<Array<any>>;\r\n    const [colData, setCol] = useState(initColData);\r\n\r\n    const waterfallControl = new WaterfallControl();\r\n    waterfallControl.setData(data);\r\n    waterfallControl.setCol(col);\r\n    \r\n    const [dataManager] = useState(waterfallControl);\r\n    const [curIdx, setCurIdx] = useState(0);\r\n\r\n    useEffect(() => {\r\n        const colWidth = refFlag[0].offsetWidth;\r\n        // 通过列的宽度去折合计算图片的宽高\r\n        waterfallControl.setColWidth(colWidth);\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        if (curIdx < len - 1) {\r\n            dataManager.pushDataToLowCol(refFlag);\r\n            setCol(dataManager.getColData());\r\n            setCurIdx(dataManager.getCurIdx());\r\n        }\r\n    }, [curIdx])\r\n\r\n    return <div className=\"zui-waterfall zui-clearfix\">\r\n        {\r\n            colData.map((val, idx) => <div key={idx}\r\n                className=\"zui-waterfall-col\"\r\n                style={{\r\n                    width: 100/col + '%'\r\n                }}>\r\n                {\r\n                    val.map((sub, subIdx) => <div key={`${idx}-${subIdx}`}\r\n                        className=\"zui-waterfall-item\">\r\n                        <img\r\n                            style={{\r\n                                width: sub.width + 'px',\r\n                                height: sub.height + 'px'\r\n                            }}\r\n                            className=\"zui-waterfall-img\"\r\n                            src={sub.url}\r\n                        />\r\n                        {/* 子模块可以自定义 */}\r\n                        { \r\n                            typeof childRender === 'function' ?\r\n                                childRender(sub) :\r\n                                <div>{sub.txt}</div>\r\n                        }\r\n                    </div>)\r\n                }\r\n                <div ref={ele => refFlag[idx] = ele}></div>\r\n            </div>)\r\n        }\r\n    </div>\r\n}\r\n\r\nexport default Waterfall;\r\n","import React from 'react';\r\nimport Waterfall from '../../../views/Waterfall'\r\n\r\nimport data from './data.js'\r\n\r\n\r\nfunction SubBody(props) {\r\n    return <div>\r\n        <p className=\"zui-waterfall-txt\">{props.txt}</p>\r\n    </div>\r\n}\r\n\r\nexport default () => {\r\n\r\n    function getSize(url) {\r\n        const sizeReg = url.match(/__(\\d{1,8})\\*(\\d{1,8})./)\r\n        return {\r\n            width: Number(sizeReg[1]),\r\n            height: Number(sizeReg[2]),\r\n        }\r\n    }\r\n\r\n    const formatData = data.map(val => {\r\n        const size = getSize(val.url)\r\n        return Object.assign({}, val, size)\r\n    })\r\n\r\n    return <div>\r\n        <Waterfall data={formatData} col={3} childRender={SubBody}></Waterfall>\r\n    </div>\r\n}","export default [\r\n    {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/20__78*241.jpg`,\r\n        txt: `这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/19__162*220.jpg`,\r\n        txt: `这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/18__130*170.jpg`,\r\n        txt: `这里是文本。这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/17__160*200.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/16__188*200.jpg`,\r\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/15__200*200.jpg`,\r\n        txt: `瀑布流`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/14__200*189.jpg`,\r\n        txt: `这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/13__181*120.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/12__208*130.jpg`,\r\n        txt: `瀑布流`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/11__150*113.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/10__220*165.jpg`,\r\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/9__150*150.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/8__200*200.jpg`,\r\n        txt: `瀑布流`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/7__200*151.jpg`,\r\n        txt: `这里是文本。这里是文本。这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/6__200*200.jpg`,\r\n        txt: `这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/5__224*174.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/4__200*200.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/3__200*200.jpg`,\r\n        txt: ``,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/2__200*200.jpg`,\r\n        txt: `这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/1__200*200.jpg`,\r\n        txt: `这里是文本。这里是文本。这里是文本。`,\r\n    }, {\r\n        url: `https://zhongmeizhi.github.io/static/test-2/0__208*130.jpg`,\r\n        txt: `瀑布流`,\r\n    }\r\n]","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || nonIterableSpread();\n}","export default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}","export default function _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}"],"sourceRoot":""}